install_fvm() {
    install_fvm_if_not_installed

    configure_shell

    source $SHELL_CONFIG

    fvm list | grep 'stable' || fvm install stable

    fvm global stable

    export PATH="$HOME/fvm/default/bin:$PATH"

    flutter doctor
}

install_fvm_if_not_installed() {
    if ! brew list fvm &> /dev/null; then
        brew tap leoafarias/fvm
        brew install fvm
        echo "✅ FVM Installed"
    else
        echo "✅ FVM already Installed"
    fi
}

configure_shell() {
    if [ "$(uname)" == "Darwin" ]; then
        SHELL_CONFIG=~/.zshrc
    else
        SHELL_CONFIG=~/.bashrc
    fi

    if ! grep -q 'export PATH="$PATH":"$HOME/.pub-cache/bin"' $SHELL_CONFIG; then
        echo 'export PATH="$PATH":"$HOME/.pub-cache/bin"' >> $SHELL_CONFIG
        echo "✅ Added flutter executables to path."
    fi

    if ! grep -q 'export PATH="$PATH":"$HOME/fvm/default/bin"' $SHELL_CONFIG; then
        if [ "$(uname)" == "Darwin" ]; then
            sed -i '' '1i\
            export PATH="$PATH":"$HOME/fvm/default/bin"' $SHELL_CONFIG
        else
            sed -i '1i\
            export PATH="$PATH":"$HOME/fvm/default/bin"' $SHELL_CONFIG
        fi
    fi
}


